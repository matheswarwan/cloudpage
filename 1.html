<br>Test Data: mascitti@email.sc.edu
<br>v0.1

<div class="container">
  <h2>Progress Bar With Label</h2>
  <div class="progress">
    <div class="progress-bar" role="progressbar" id="progress-bar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%">
      0%
    </div>
  </div>
</div>

<input type="text" id="searchValue" maxlength="128" value="frankieboymunizza@comcast.net">
<a href="javascript:getDENames()">Search this..</a>

<div id="d1"></div>
<div id="d2"></div>

<script>
  

var progBarCount = 0;

async function getDEData(CustomerKey, DEName, i) { 
    var searchValue = document.getElementById('searchValue').value;
     /* DE Query call  - starts */
     var theUrl = "https://pub.s7.exacttarget.com/prus4132iqz?Method=DEQuery&SearchKey="+searchValue+"&ColumnName="+"PC_Email_Address"+"&CustomerKey=" + CustomerKey;
     console.log("going to call " + theUrl);
     var xhrDEQuery = new XMLHttpRequest();
     xhrDEQuery.open("GET", theUrl, true);
     xhrDEQuery.onload = function (e) {
     if (xhrDEQuery.readyState === 4) {
         if (xhrDEQuery.status === 200) {
             progBarCount = i * 100 ;
             console.log("ProgBarCount >>> "+ i*100 );
     
             document.getElementById("progress-bar").innerText= progBarCount + "%";
             document.getElementById("progress-bar").style.width = progBarCount + "%";

             var getDEQueryresp = JSON.parse(xhrDEQuery.response);
             if (getDEQueryresp != null) {
                document.getElementById("d2").innerText += "<br> DE Name: " + DEName + "<br>";
                document.getElementById("d2").innerText += xhrDEQuery.responseText + " <br><br>";
             }

         } else {
             console.error(xhrDEQuery.statusText);
             alert( xhrDEQuery.statusText );
           }
         }
       };
       xhrDEQuery.onerror = function (e) {
         console.error(xhrDEQuery.statusText);
       };
       xhrDEQuery.send(null);  
     /* DE Query call  - ends */
}

async function getDENames() {
    var theUrl = "https://pub.s7.exacttarget.com/prus4132iqz?Method=DESearch&SearchKey="+"_CustomerCareFile";
    var xhr = new XMLHttpRequest();
     xhr.open("GET", theUrl, true);
     xhr.onload = function (e) {
       if (xhr.readyState === 4) {
         if (xhr.status === 200) {
           console.log("GetDENames Response --> " + xhr.responseText);
           //document.getElementById("d1").innerText = xhr.responseText;
           var getDENamesresp = JSON.parse(xhr.response);
           console.log("# of DEs to queries --> " +getDENamesresp.length);
           //Write code for next call

           for(var i=0;i<getDENamesresp.length;i++) {
            console.log(getDENamesresp[i]["Name"]);
            console.log(getDENamesresp[i]["CustomerKey"]);
            console.log("% of move in progress bar " + ((100/getDENamesresp.length) * (i+1)).toFixed(0)  );
            getDEData(  getDENamesresp[i]["CustomerKey"], 
                        getDENamesresp[i]["Name"], 
                        ((i+1)/getDENamesresp.length).toFixed(0) ); 
           }
         } else {
           console.error(xhr.statusText);
           alert( xhr.statusText );
         }
       }
     };
     xhr.onerror = function (e) {
       console.error(xhr.statusText);
     };
     xhr.send(null);    
 }
  
</script>

<!--
<form action="%%=RequestParameter('https://pub.s7.exacttarget.com/slei2rwru01')=%%" method="post">
  Email Address 
  <input type="text" name="colValueToFilter" maxlength="128" value="%%=RequestParameter('colValueToFilter')=%%">
  <input type="submit" value="Submit">
</form>-->
<br>
<br>

